<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>æœˆéŒ² - è¨˜éŒ²</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: #f5f7fa;
      color: #333;
      padding-bottom: 80px;
    }
    header {
      background: #fff;
      padding: 16px;
      border-bottom: 1px solid #ddd;
      position: sticky;
      top: 0;
    }
    h1 {
      margin: 0;
      font-size: 1.4rem;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      padding: 16px;
    }
    section {
      background: #fff;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
    section h2 {
      font-size: 1.1rem;
      margin-top: 0;
    }
    label {
      display: block;
      margin-top: 12px;
      font-size: 0.9rem;
    }
    input, select, textarea {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1rem;
      box-sizing: border-box;
    }
    button {
      margin-top: 12px;
      padding: 10px 16px;
      background: #3b82f6;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>
    <h1>è¨˜éŒ²ã™ã‚‹</h1>
  </header>

  <div class="container">
    <label for="month">å¯¾è±¡æœˆ</label>
    <input type="month" id="month" />

    <!-- æ­©æ•° -->
    <section>
      <h2>æ­©æ•°</h2>
      <label>æ—¥ä»˜</label>
      <input type="date" id="stepsDate" />
      <label>æ­©æ•°</label>
      <input type="number" id="stepsCount" placeholder="ä¾‹: 7500" />
      <button onclick="saveSteps()">ä¿å­˜</button>
    </section>

    <!-- æ”¯å‡º -->
    <section>
      <h2>æ”¯å‡º</h2>
      <label>æ—¥ä»˜</label>
      <input type="date" id="expDate" />
      <label>é‡‘é¡ï¼ˆå††ï¼‰</label>
      <input type="number" id="expAmount" />
      <label>ã‚«ãƒ†ã‚´ãƒª</label>
      <input type="text" id="expCat" placeholder="ä¾‹: é£Ÿè²»" />
      <button onclick="saveExpense()">ä¿å­˜</button>
    </section>

    <!-- äºˆå®š -->
    <section>
      <h2>äºˆå®š</h2>
      <label>æ—¥ä»˜</label>
      <input type="date" id="calDate" />
      <label>ã‚¿ã‚¤ãƒˆãƒ«</label>
      <input type="text" id="calTitle" />
      <label>æ‰€è¦æ™‚é–“ï¼ˆåˆ†ï¼‰</label>
      <input type="number" id="calDuration" />
      <button onclick="saveCalendar()">ä¿å­˜</button>
    </section>

    <!-- SNS -->
    <section>
      <h2>SNSæŠ•ç¨¿</h2>
      <label>æ—¥ä»˜</label>
      <input type="date" id="snsDate" />
      <label>ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ </label>
      <select id="snsPlatform">
        <option value="x">X</option>
        <option value="instagram">Instagram</option>
        <option value="youtube">YouTube</option>
        <option value="tiktok">TikTok</option>
      </select>
      <label>æŠ•ç¨¿æ•°</label>
      <input type="number" id="snsCount" />
      <button onclick="saveSNS()">ä¿å­˜</button>
    </section>

    <!-- æ°—åˆ† -->
    <section>
      <h2>æ°—åˆ†</h2>
      <label>æ—¥ä»˜</label>
      <input type="date" id="moodDate" />
      <label>æ°—åˆ†</label>
      <select id="moodEmoji">
        <option value="ğŸ˜Š">ğŸ˜Š ã‚„ã‚„è‰¯ã„</option>
        <option value="ğŸ˜">ğŸ˜ ãµã¤ã†</option>
        <option value="ğŸ˜Ÿ">ğŸ˜Ÿ å°‘ã—ä¸å®‰</option>
        <option value="ğŸ˜¢">ğŸ˜¢ ã¤ã‹ã‚ŒãŸ</option>
        <option value="ğŸ˜„">ğŸ˜„ ã¨ã¦ã‚‚è‰¯ã„</option>
      </select>
      <label>ãƒ¡ãƒ¢</label>
      <input type="text" id="moodNote" />
      <button onclick="saveMood()">ä¿å­˜</button>
    </section>
  </div>

  <div id="navbar"></div>

  <script>
    const monthInput = document.getElementById("month");
    const today = new Date();
    monthInput.value = today.toISOString().slice(0, 7);

    function getMonthKey() {
      return monthInput.value;
    }

    function openDB() {
      return new Promise((resolve, reject) => {
        const req = indexedDB.open("MyMonthDB_v2", 1);
        req.onupgradeneeded = (e) => {
          const db = e.target.result;
          if (!db.objectStoreNames.contains("monthlyData")) {
            db.createObjectStore("monthlyData", { keyPath: "month" });
          }
        };
        req.onsuccess = () => resolve(req.result);
        req.onerror = () => reject(req.error);
      });
    }

    async function getMonthData(monthKey) {
      const db = await openDB();
      return new Promise((resolve, reject) => {
        const tx = db.transaction("monthlyData", "readonly");
        const store = tx.objectStore("monthlyData");
        const req = store.get(monthKey);
        req.onsuccess = () => {
          resolve(req.result || {
            month: monthKey,
            steps: [],
            expenses: [],
            calendarEvents: [],
            snsPosts: [],
            moods: [],
            monthlyNote: ""
          });
        };
        req.onerror = () => reject(req.error);
      });
    }

    async function saveMonthData(data) {
      const db = await openDB();
      const tx = db.transaction("monthlyData", "readwrite");
      tx.objectStore("monthlyData").put(data);
    }

    async function saveSteps() {
      const date = document.getElementById("stepsDate").value;
      const count = Number(document.getElementById("stepsCount").value);
      if (!date || !count) return alert("æ—¥ä»˜ã¨æ­©æ•°ã‚’å…¥åŠ›ã—ã¦ã­ï¼");
      const monthKey = getMonthKey();
      const data = await getMonthData(monthKey);
      const existing = data.steps.find(s => s.date === date);
      if (existing) existing.count = count;
      else data.steps.push({ date, count });
      await saveMonthData(data);
      alert("æ­©æ•°ã‚’ä¿å­˜ã—ãŸã‚ˆï¼");
    }

    async function saveExpense() {
      const date = document.getElementById("expDate").value;
      const amount = Number(document.getElementById("expAmount").value);
      const category = document.getElementById("expCat").value || "æœªåˆ†é¡";
      if (!date || !amount) return alert("æ—¥ä»˜ã¨é‡‘é¡ã‚’å…¥åŠ›ã—ã¦ã­ï¼");
      const monthKey = getMonthKey();
      const data = await getMonthData(monthKey);
      data.expenses.push({ date, amount, category });
      await saveMonthData(data);
      alert("æ”¯å‡ºã‚’ä¿å­˜ã—ãŸã‚ˆï¼");
    }

    async function saveCalendar() {
      const date = document.getElementById("calDate").value;
      const title = document.getElementById("calTitle").value;
      const duration = Number(document.getElementById("calDuration").value);
      if (!date || !title || !duration) return alert("ã™ã¹ã¦å…¥åŠ›ã—ã¦ã­ï¼");
      const monthKey = getMonthKey();
      const data = await getMonthData(monthKey);
      data.calendarEvents.push({ date, title, duration });
      await saveMonthData(data);
      alert("äºˆå®šã‚’ä¿å­˜ã—ãŸã‚ˆï¼");
    }

    async function saveSNS() {
      const date = document.getElementById("snsDate").value;
      const platform = document.getElementById("snsPlatform").value;
      const count = Number(document.getElementById("snsCount").value);
            if (!date || !count) return alert("æ—¥ä»˜ã¨æŠ•ç¨¿æ•°ã‚’å…¥åŠ›ã—ã¦ã­ï¼");
      const monthKey = getMonthKey();
      const data = await getMonthData(monthKey);
      data.snsPosts.push({ date, platform, count });
      await saveMonthData(data);
      alert("SNSæŠ•ç¨¿ã‚’ä¿å­˜ã—ãŸã‚ˆï¼");
    }

    async function saveMood() {
      const date = document.getElementById("moodDate").value;
      const emoji = document.getElementById("moodEmoji").value;
      const note = document.getElementById("moodNote").value;
      if (!date || !emoji) return alert("æ—¥ä»˜ã¨æ°—åˆ†ã‚’é¸ã‚“ã§ã­ï¼");
      const monthKey = getMonthKey();
      const data = await getMonthData(monthKey);
      const existing = data.moods.find(m => m.date === date);
      if (existing) {
        existing.emoji = emoji;
        existing.note = note;
      } else {
        data.moods.push({ date, emoji, note });
      }
      await saveMonthData(data);
      alert("æ°—åˆ†ã‚’ä¿å­˜ã—ãŸã‚ˆï¼");
    }

    // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼èª­ã¿è¾¼ã¿
    fetch("navbar.html")
      .then(res => res.text())
      .then(html => {
        document.getElementById("navbar").innerHTML = html;
      });
  </script>
  <script>
  // Androidã‹ã‚‰ã®æ­©æ•°ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã£ã¦ã€è‡ªå‹•å…¥åŠ›ã™ã‚‹
  window.addEventListener("message", (event) => {
    if (event.data && event.data.type === "stepCount") {
      const count = event.data.value;
      const stepsInput = document.getElementById("stepsCount");
      if (stepsInput) {
        stepsInput.value = count;
        console.log("æ­©æ•°ã‚’å—ä¿¡:", count);
      }
    }
  });
</script>

</body>
</html>

